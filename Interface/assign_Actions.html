<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madar System - Assign Action Item</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="custom.css">
</head>

<body>
<!-- Sidebar Navigation -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <img src="logo.png" height="50" style="margin-right: 10px;">
        <h4>Madar System</h4>
    </div>
    <ul class="sidebar-nav">
        <li><a href="#" ><i class="fas fa-chart-line"></i> <span>Dashboard</span></a></li>
        <li><a href="area-audits.html"><i class="fas fa-clipboard-list"></i> <span>Area Audits</span></a></li>
        <li><a href="assign_Actions.html" class="active"><i class="fas fa-tasks"></i> <span>Assign Actions</span></a></li>
        <li><a href="responsible-persons.html"><i class="fas fa-users"></i> <span>Responsible Persons</span></a></li>
        <li><a href="#"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
    </ul>
</div>

<!-- Main Content -->
<div class="main-content" id="main-content">
    <!-- Header -->
    <nav class="navbar d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <button class="toggle-sidebar" id="toggle-sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <h4 class="mb-0" style="color: var(--dark-blue);">Assign Action Items</h4>
        </div>
        <div class="d-flex align-items-center">
            <button class="btn notification-btn">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">5</span>
            </button>
            <div class="dropdown">
                <button class="btn user-dropdown dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <div class="user-avatar">
                        <i class="fas fa-user text-white"></i>
                    </div>
                    <span>Reyoof Almudarra</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i>Profile</a></li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i>Settings</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

 <div class="row">
     <div class="col-md-8">
         <!-- Pending Issues Section -->
         <div class="card mb-4 p-4">
             <div class="card-body">
                 <h5 class="section-title"><i class="fas fa-exclamation-triangle me-2"></i>Pending Issues for Assignment</h5>

                 <div class="table-responsive">
                     <table class="table table-hover">
                         <thead>
                         <tr>
                             <th width="5%">
                                 <input type="checkbox" id="selectAll">
                             </th>
                             <th width="15%">Issue ID</th>
                             <th width="20%">Audit</th>
                             <th width="25%">Issue Description</th>
                             <th width="15%">Type</th>
                             <th width="10%">Priority</th>
                             <th width="10%">Date Found</th>
                         </tr>
                         </thead>
                         <tbody>
                         <tr>
                             <td>
                                 <input type="checkbox" class="issue-checkbox" data-issue="ISS-001">
                             </td>
                             <td>ISS-001</td>
                             <td>AUD-002 - Plant B</td>
                             <td>Fire extinguisher blocked by storage materials</td>
                             <td><span class="badge bg-danger">Non-Conformity</span></td>
                             <td><span class="badge bg-danger">High</span></td>
                             <td>2024-01-15</td>
                         </tr>
                         <tr>
                             <td>
                                 <input type="checkbox" class="issue-checkbox" data-issue="ISS-002">
                             </td>
                             <td>ISS-002</td>
                             <td>AUD-002 - Plant B</td>
                             <td>5 workers not wearing safety glasses</td>
                             <td><span class="badge bg-warning">Observation</span></td>
                             <td><span class="badge bg-warning">Medium</span></td>
                             <td>2024-01-15</td>
                         </tr>
                         <tr>
                             <td>
                                 <input type="checkbox" class="issue-checkbox" data-issue="ISS-003">
                             </td>
                             <td>ISS-003</td>
                             <td>AUD-006 - Plant A</td>
                             <td>Missing machine guard</td>
                             <td><span class="badge bg-danger">Non-Conformity</span></td>
                             <td><span class="badge bg-danger">High</span></td>
                             <td>2024-01-12</td>
                         </tr>
                         <tr>
                             <td>
                                 <input type="checkbox" class="issue-checkbox" data-issue="ISS-004">
                             </td>
                             <td>ISS-004</td>
                             <td>AUD-006 - Plant A</td>
                             <td>Emergency exit sign not illuminated</td>
                             <td><span class="badge bg-warning">Observation</span></td>
                             <td><span class="badge bg-warning">Medium</span></td>
                             <td>2024-01-12</td>
                         </tr>
                         <tr>
                             <td>
                                 <input type="checkbox" class="issue-checkbox" data-issue="ISS-005">
                             </td>
                             <td>ISS-005</td>
                             <td>AUD-003 - Plant C</td>
                             <td>Electrical panel access blocked by equipment</td>
                             <td><span class="badge bg-danger">Non-Conformity</span></td>
                             <td><span class="badge bg-danger">High</span></td>
                             <td>2024-01-10</td>
                         </tr>
                         </tbody>
                     </table>
                 </div>
             </div>
         </div>
         <div class="card mt-4">
             <div class="card-body">
                 <h5 class="section-title"><i class="fas fa-history me-2"></i>Recently Assigned Actions</h5>

                 <div class="table-responsive">
                     <table class="table table-hover">
                         <thead>
                         <tr>
                             <th>Action ID</th>
                             <th>Issue</th>
                             <th>Assigned To</th>
                             <th>Deadline</th>
                             <th>Priority</th>
                             <th>Status</th>
                             <th>Actions</th>
                         </tr>
                         </thead>
                         <tbody>
                         <tr>
                             <td>ACT-024</td>
                             <td>Repair broken handrail - Staircase B</td>
                             <td>Alanoud Alkhaldi</td>
                             <td>2024-01-20</td>
                             <td><span class="badge bg-warning">Medium</span></td>
                             <td><span class="badge bg-primary">Assigned</span></td>
                             <td>
                                 <button class="btn btn-sm btn-outline-primary me-1" title="View">
                                     <i class="fas fa-eye"></i>
                                 </button>
                                 <button class="btn btn-sm btn-outline-warning" title="Reassign">
                                     <i class="fas fa-user-edit"></i>
                                 </button>
                             </td>
                         </tr>
                         <tr>
                             <td>ACT-023</td>
                             <td>Install additional emergency lighting</td>
                             <td>Sarah Alshammari</td>
                             <td>2024-01-25</td>
                             <td><span class="badge bg-danger">High</span></td>
                             <td><span class="badge bg-success">In Progress</span></td>
                             <td>
                                 <button class="btn btn-sm btn-outline-primary me-1" title="View">
                                     <i class="fas fa-eye"></i>
                                 </button>
                                 <button class="btn btn-sm btn-outline-warning" title="Reassign">
                                     <i class="fas fa-user-edit"></i>
                                 </button>
                             </td>
                         </tr>
                         <tr>
                             <td>ACT-022</td>
                             <td>Replace damaged safety signage</td>
                             <td>Shouq A.Alshehry</td>
                             <td>2024-01-18</td>
                             <td><span class="badge bg-warning">Medium</span></td>
                             <td><span class="badge bg-success">Completed</span></td>
                             <td>
                                 <button class="btn btn-sm btn-outline-primary me-1" title="View">
                                     <i class="fas fa-eye"></i>
                                 </button>
                                 <button class="btn btn-sm btn-outline-warning" title="Reassign">
                                     <i class="fas fa-user-edit"></i>
                                 </button>
                             </td>
                         </tr>
                         </tbody>
                     </table>
                 </div>
             </div>
         </div>
     </div>

     <div class="col-md-4">


         <!-- Assignment Form -->
         <div class="card p-4">
             <div class="card-body">
                 <h5 class="section-title"><i class="fas fa-user-check me-2"></i>Assign to Responsible Person</h5>

                 <form id="assignActionForm">
                     <div class="row g-3">
                         <div class="col-md-12">
                             <label for="responsiblePerson" class="form-label required-field">Responsible Person</label>
                             <select class="form-select" id="responsiblePerson" name="responsiblePerson" required>
                                 <option value="" selected disabled>Select Responsible Person</option>
                                 <option value="RESP-001">Alanoud Alkhaldi - Maintenance Supervisor</option>
                                 <option value="RESP-002">Sarah Alshammari - Safety Coordinator</option>
                                 <option value="RESP-003">Shouq A.Alshehry - Production Lead</option>
                                 <option value="RESP-004">Rola Alamri - Facility Manager</option>
                             </select>
                         </div>
                         <div class="col-md-12">
                             <label for="deadlineDate" class="form-label required-field">Deadline Date</label>
                             <input type="date" class="form-control" id="deadlineDate" name="deadlineDate" required>
                         </div>
                     </div>

                     <div class="row g-3 mt-2">
                         <div class="col-md-12">
                             <label for="actionDescription" class="form-label">Action Description</label>
                             <textarea class="form-control" id="actionDescription" name="actionDescription" rows="3" placeholder="Describe the corrective action required..."></textarea>
                         </div>
                         <div class="col-md-12">
                             <label for="priorityLevel" class="form-label">Priority Level</label>
                             <select class="form-select" id="priorityLevel" name="priorityLevel">
                                 <option value="low">Low</option>
                                 <option value="medium" selected>Medium</option>
                                 <option value="high">High</option>
                                 <option value="critical">Critical</option>
                             </select>

                             <label for="category" class="form-label mt-3">Category</label>
                             <select class="form-select" id="category" name="category">
                                 <option value="safety">Safety</option>
                                 <option value="equipment">Equipment</option>
                                 <option value="ppe">PPE</option>
                                 <option value="fire">Fire Safety</option>
                                 <option value="electrical">Electrical</option>
                                 <option value="general">General</option>
                             </select>
                         </div>
                     </div>

                     <!-- Selected Issues Preview -->
                     <div class="mt-4" id="selectedIssuesSection" style="display: none;">
                         <h6 class="mb-3">Selected Issues for Assignment:</h6>
                         <div class="selected-issues-container" id="selectedIssuesContainer">
                             <!-- Selected issues will appear here -->
                         </div>
                     </div>

                     <!-- Action Buttons -->
                     <div class="d-flex justify-content-between mt-4">
                         <button type="button" class="btn btn-outline-secondary" id="clearSelection">
                             <i class="fas fa-times me-2"></i>Clear Selection
                         </button>
                         <div>

                             <button type="submit" class="btn btn-primary" id="assignAction">
                                 <i class="fas fa-paper-plane me-2"></i>Assign Action
                             </button>
                         </div>
                     </div>
                 </form>
             </div>
         </div>
     </div>
 </div>

    <!-- Recently Assigned Actions -->

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="custom.js"></script>
<script>
    // Assign Action Item specific functionality
    document.addEventListener('DOMContentLoaded', function() {
        const selectedIssues = new Set();
        const selectAllCheckbox = document.getElementById('selectAll');
        const issueCheckboxes = document.querySelectorAll('.issue-checkbox');
        const selectedIssuesSection = document.getElementById('selectedIssuesSection');
        const selectedIssuesContainer = document.getElementById('selectedIssuesContainer');
        const clearSelectionBtn = document.getElementById('clearSelection');

        // Set default deadline to 7 days from now
        const defaultDeadline = new Date();
        defaultDeadline.setDate(defaultDeadline.getDate() + 7);
        document.getElementById('deadlineDate').value = defaultDeadline.toISOString().split('T')[0];

        // Select All functionality
        selectAllCheckbox.addEventListener('change', function() {
            issueCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
                if (this.checked) {
                    selectedIssues.add(checkbox.dataset.issue);
                } else {
                    selectedIssues.delete(checkbox.dataset.issue);
                }
            });
            updateSelectedIssuesDisplay();
        });

        // Individual checkbox functionality
        issueCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    selectedIssues.add(this.dataset.issue);
                } else {
                    selectedIssues.delete(this.dataset.issue);
                    selectAllCheckbox.checked = false;
                }
                updateSelectedIssuesDisplay();
            });
        });

        // Update selected issues display
        function updateSelectedIssuesDisplay() {
            if (selectedIssues.size > 0) {
                selectedIssuesSection.style.display = 'block';
                selectedIssuesContainer.innerHTML = '';

                selectedIssues.forEach(issueId => {
                    const issueRow = document.querySelector(`.issue-checkbox[data-issue="${issueId}"]`).closest('tr');
                    const issueData = {
                        id: issueRow.cells[1].textContent,
                        audit: issueRow.cells[2].textContent,
                        description: issueRow.cells[3].textContent,
                        type: issueRow.cells[4].textContent,
                        priority: issueRow.cells[5].textContent
                    };

                    const issueElement = document.createElement('div');
                    issueElement.className = 'selected-issue alert alert-info py-2 mb-2';
                    issueElement.innerHTML = `
              <strong>${issueData.id}</strong> - ${issueData.description}
              <span class="badge bg-danger float-end">${issueData.priority}</span>
            `;
                    selectedIssuesContainer.appendChild(issueElement);
                });
            } else {
                selectedIssuesSection.style.display = 'none';
            }
        }

        // Clear selection
        clearSelectionBtn.addEventListener('click', function() {
            selectedIssues.clear();
            issueCheckboxes.forEach(checkbox => checkbox.checked = false);
            selectAllCheckbox.checked = false;
            updateSelectedIssuesDisplay();
        });

        // Form submission
        document.getElementById('assignActionForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (selectedIssues.size === 0) {
                alert('Please select at least one issue to assign.');
                return;
            }

            const responsiblePerson = document.getElementById('responsiblePerson').value;
            const deadline = document.getElementById('deadlineDate').value;

            if (!responsiblePerson || !deadline) {
                alert('Please fill in all required fields.');
                return;
            }

            // In a real application, this would submit to the server
            alert(`Successfully assigned ${selectedIssues.size} issue(s) to ${document.getElementById('responsiblePerson').options[document.getElementById('responsiblePerson').selectedIndex].text}`);

            // Reset form
            this.reset();
            selectedIssues.clear();
            issueCheckboxes.forEach(checkbox => checkbox.checked = false);
            selectAllCheckbox.checked = false;
            updateSelectedIssuesDisplay();

            // Set default deadline again
            document.getElementById('deadlineDate').value = defaultDeadline.toISOString().split('T')[0];
        });

        // Save draft functionality
        document.getElementById('saveDraft').addEventListener('click', function() {
            if (selectedIssues.size === 0) {
                alert('Please select at least one issue to save as draft.');
                return;
            }
            alert('Draft saved successfully!');
        });
    });
</script>
</body>
</html>